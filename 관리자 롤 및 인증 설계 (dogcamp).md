관리자 롤 및 인증 설계 (dogcamp)
1. 롤(Role) 구조
롤 종류 (초기 버전):
ADMIN: 모든 관리 기능 접근 가능
캠핑장 CRUD
애완견 정책 수정
크롤링/데이터 연동 로그 조회
향후 필요 시:
EDITOR (일부 수정만 가능), VIEWER (조회만 가능) 등으로 확장 여지를 남겨둠
2. 롤 저장 위치
Supabase auth.users의 app_metadata.role 필드 사용
예시:
  {    "app_metadata": {      "role": "ADMIN"    }  }공공데이터 / 지자체 캠핑장  2. 소규모 캠핑 포털 / 개별 캠핑장 사이트  3. 대형 상업 포털(여행/예약 플랫폼)은     - 공식 API / 제휴가 가능한 경우에만 데이터 연동     - 그 외에는 HTML 크롤링 대신 딥링크 중심 전략- 공통 원칙:  - 각 사이트의 `robots.txt` 및 이용약관을 준수  - 크롤링이 명확히 금지된 경우, HTML 크롤링은 하지 않음  - 가능하면 공식 API / 공공 데이터셋을 우선 사용## 2. 후보 사이트 리스트 (예시)> 아래는 실제 사이트 이름이 아니라 “유형별 예시”입니다.  > 나중에 실제로 조사하면서 각 행에 진짜 사이트 이름/URL을 넣어 채우면 됩니다.| 이름                       | URL                       | 유형         | 사용 방식               | robots.txt 요약      | 이용약관 요약                                  | 상태       | 비고                                      ||----------------------------|---------------------------|--------------|-------------------------|----------------------|-----------------------------------------------|-----------|-------------------------------------------|| 공공데이터포털 캠핑장 API | (공공데이터포털 링크)     | 공공         | 공공 API / CSV import  | 보통 허용 (조건 확인) | 상업적 이용 가능 여부/출처 표시 조건 확인 필요 | PoC 대상  | 반려견 필드가 없으면 텍스트에서 추출 시도 || A 지자체 캠핑장 페이지    | (예: ○○도 캠핑장 안내 페이지) | 지자체/공공 | HTML 크롤링            | 보통 제한적/허용     | 공공 안내 성격, 크롤링 가능 여부 확인 필요      | 후보      | 반려견 문구가 단순 텍스트로 표기될 수 있음 || B 소규모 캠핑 포털        | (예: 중소 캠핑 정보 사이트) | 소규모 포털 | HTML 크롤링            | 사이트별 상이         | 크롤링/스크래핑 관련 조항 확인 필요            | 후보      | 구조가 단순하면 1차 PoC 대상으로 적합     || C 개별 캠핑장 사이트      | (예: 인기 반려견 캠핑장 BLG) | 개별 사이트 | HTML 크롤링            | 보통 robots 없음/단순 | 대개 명시X, 트래픽에 부담 안되는 선에서 사용   | 후보      | 반려견 특화 캠핑장은 브랜드 가치 높음     || D 대형 여행사/예약 포털   | (예: 대형 여행/예약 플랫폼) | 대형 포털   | 공식 API/제휴 검토     | 자주 크롤링 금지      | 무단 크롤링/상업적 이용 금지 조항 있는 경우 多 | 보류/검토 | HTML 크롤링 대상 X, 제휴/딥링크 위주       |## 3. 1차 PoC 대상 선정 (예시)- 1차 PoC 우선 후보:  - 공공데이터포털 캠핑장 API (공공 + 안정적)  - B 소규모 캠핑 포털 (구조가 단순하고 반려견 정보가 어느 정도 있음)- 이유:  - 공공 데이터는 라이선스 조건만 맞으면 안정적으로 사용 가능  - 소규모 포털은 구조가 단순해 크롤러 설계/테스트에 적합> 실제 조사 후에는 각 행에 대해  > - `상태`를 `PoC 대상 / 후보 / 보류 / 제외`로 업데이트하고,  > - robots/이용약관 내용을 한 줄씩 채워 넣으면 됩니다.
3. 관리자 계정 생성 프로세스
3.1 첫 관리자 계정
이메일: admin@dogcamp.com
생성 절차:
Supabase 콘솔 → Authentication → Users에서
이메일: admin@dogcamp.com
비밀번호: (강한 비밀번호로 직접 설정)
이메일 인증은 사용하지 않으므로, 별도의 인증 메일 확인 없이 바로 사용 가능
해당 유저의 app_metadata.role을 "ADMIN"으로 설정
3.2 추가 관리자
추후 기능:
관리자 페이지에서 ADMIN이 다른 유저 이메일을 입력하면,
해당 유저의 role을 "ADMIN" 또는 "EDITOR"로 승격하는 API 제공
초기 단계에서는:
필요 시 Supabase 콘솔에서 직접 추가/수정
4. 접근 제어 방식
4.1 페이지 라우트 보호(/admin/*)
정책:
/admin/* 라우트는 항상 로그인된 ADMIN만 접근 가능
구현 아이디어:
클라이언트:
Supabase Auth를 사용해 현재 세션/유저 정보 조회
role !== "ADMIN"이면 /login 또는 권한 부족 페이지로 리다이렉트
서버:
Next.js의 middleware.ts에서 /admin 경로에 대해 쿠키/토큰 검사 후,
권한이 없으면 리다이렉트
4.2 API 라우트 보호(/api/admin/*)
정책:
/api/admin/*는 항상 서버 측에서 role === "ADMIN"인지 검사
구현 아이디어:
요청 헤더나 쿠키에서 Supabase 세션/JWT 추출
Supabase SDK나 JWT 검증으로 유저 아이디/role 확인
role !== "ADMIN"이면 403 Forbidden 응답
5. 에러 처리 UX
인증 실패:
로그인 페이지로 리다이렉트 + “다시 로그인해 주세요” 메시지
권한 부족:
“관리자 권한이 필요한 페이지입니다” 안내 및 홈/로그인 링크 제공
---### 3. `data-sources-matrix.md` (예시 후보 리스트 포함)# 데이터 소스 및 정책 매트릭스 (dogcamp)## 1. 요약 원칙- 우선 순위:  1. 공공데이터 / 지자체 캠핑장  2. 소규모 캠핑 포털 / 개별 캠핑장 사이트  3. 대형 상업 포털(여행/예약 플랫폼)은     - 공식 API / 제휴가 가능한 경우에만 데이터 연동     - 그 외에는 HTML 크롤링 대신 딥링크 중심 전략- 공통 원칙:  - 각 사이트의 `robots.txt` 및 이용약관을 준수  - 크롤링이 명확히 금지된 경우, HTML 크롤링은 하지 않음  - 가능하면 공식 API / 공공 데이터셋을 우선 사용## 2. 후보 사이트 리스트 (예시)> 아래는 실제 사이트 이름이 아니라 “유형별 예시”입니다.  > 나중에 실제로 조사하면서 각 행에 진짜 사이트 이름/URL을 넣어 채우면 됩니다.| 이름                       | URL                       | 유형         | 사용 방식               | robots.txt 요약      | 이용약관 요약                                  | 상태       | 비고                                      ||----------------------------|---------------------------|--------------|-------------------------|----------------------|-----------------------------------------------|-----------|-------------------------------------------|| 공공데이터포털 캠핑장 API | (공공데이터포털 링크)     | 공공         | 공공 API / CSV import  | 보통 허용 (조건 확인) | 상업적 이용 가능 여부/출처 표시 조건 확인 필요 | PoC 대상  | 반려견 필드가 없으면 텍스트에서 추출 시도 || A 지자체 캠핑장 페이지    | (예: ○○도 캠핑장 안내 페이지) | 지자체/공공 | HTML 크롤링            | 보통 제한적/허용     | 공공 안내 성격, 크롤링 가능 여부 확인 필요      | 후보      | 반려견 문구가 단순 텍스트로 표기될 수 있음 || B 소규모 캠핑 포털        | (예: 중소 캠핑 정보 사이트) | 소규모 포털 | HTML 크롤링            | 사이트별 상이         | 크롤링/스크래핑 관련 조항 확인 필요            | 후보      | 구조가 단순하면 1차 PoC 대상으로 적합     || C 개별 캠핑장 사이트      | (예: 인기 반려견 캠핑장 BLG) | 개별 사이트 | HTML 크롤링            | 보통 robots 없음/단순 | 대개 명시X, 트래픽에 부담 안되는 선에서 사용   | 후보      | 반려견 특화 캠핑장은 브랜드 가치 높음     || D 대형 여행사/예약 포털   | (예: 대형 여행/예약 플랫폼) | 대형 포털   | 공식 API/제휴 검토     | 자주 크롤링 금지      | 무단 크롤링/상업적 이용 금지 조항 있는 경우 多 | 보류/검토 | HTML 크롤링 대상 X, 제휴/딥링크 위주       |## 3. 1차 PoC 대상 선정 (예시)- 1차 PoC 우선 후보:  - 공공데이터포털 캠핑장 API (공공 + 안정적)  - B 소규모 캠핑 포털 (구조가 단순하고 반려견 정보가 어느 정도 있음)- 이유:  - 공공 데이터는 라이선스 조건만 맞으면 안정적으로 사용 가능  - 소규모 포털은 구조가 단순해 크롤러 설계/테스트에 적합> 실제 조사 후에는 각 행에 대해  > - `상태`를 `PoC 대상 / 후보 / 보류 / 제외`로 업데이트하고,  > - robots/이용약관 내용을 한 줄씩 채워 넣으면 됩니다.